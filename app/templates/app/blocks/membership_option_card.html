{% load wagtailcore_tags django_bootstrap5 url %}
{% with option.plan.products.all as products %}
  <article class='col col-md-4'>
    <div class='{% firstof option.background_color "bg-yellow" %} overflow-hidden h-100 d-flex flex-column'>
      <div class='
        {% if not option.promotion_label %}opacity-0{% else %}opacity-50{% endif %}
        py-2 text-uppercase overflow-hidden tw-whitespace-nowrap tw-font-serif fs-7
      '>
        {% comment %} Loop center:N times {% endcomment %}
        {% with ''|center:50 as range %}
          {% for _ in range %}
            {% firstof option.promotion_label "placeholder" %}
          {% endfor %}
        {% endwith %}
      </div>
      <div class='px-4 pt-1 pb-4'>
          <h3 class='mb-2'>{{ option.plan.title }}</h3>
          <div class='fw-bold'>{% include "app/includes/plan_price.html" with price=request_price %}</div>
          <div class='fw-bold'>A book {{ option.plan.delivery_frequency }}</div>
          <div class='mt-2'>{{ option.plan.description|richtext }}</div>
          {% qs_link as qs %}
      </div>
      <div class='mt-auto p-4'>
        {% if products|length == 1 %}
          {% with products.0 as product %}
            {% url "plan_shipping" price_id=request_price.id product_id=product.id as url %}
            {% qs_link gift_mode=None as not_gift_qs %}
            {% bootstrap_button button_class='btn-outline-dark' href=url|add:not_gift_qs content="Select" %}
            {% qs_link gift_mode=True as gift_qs %}
            {% bootstrap_button button_class='btn-outline-dark' href=url|add:gift_qs content="Get this as a gift" %}
          {% endwith %}
        {% else %}
          {% bootstrap_button button_class='btn-outline-dark' href=option.plan.url|add:qs content="Select" %}
          {% qs_link gift_mode=True as gift_qs %}
          {% bootstrap_button button_class='btn-outline-dark' href=option.plan.url|add:gift_qs content="Get this as a gift" %}
        {% endif %}
      </div>
    </div>
  </article>
{% endwith %}

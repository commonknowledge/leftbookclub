{% extends "base.html" %}
{% load wagtailcore_tags wagtailimages_tags setting valid_json %}

{% block content%}

<article
  data-controller="product"
  data-product-shopify-domain-value="{% setting 'SHOPIFY_DOMAIN' %}"
  data-product-shopify-storefront-access-token-value="{% setting 'SHOPIFY_STOREFRONT_ACCESS_TOKEN' %}"
  data-product-shopify-collection-id-value="{% setting 'SHOPIFY_COLLECTION_ID' %}"
  data-product-shopify-product-id-value="gid://shopify/Product/{{ page.shopify_product_id }}"
  data-product-user-email-value="{{ user.primary_email }}"
  data-product-stripe-shipping-value='{{ user.stripe_customer.shipping|valid_json }}'
>
  <h1>{{product.title}}</h1>

  <div class="row">
    <div class="col-12 col-lg-7">

      <div id="carouselExampleControls" class="carousel slide" data-ride="carousel">
        <div class="carousel-inner">
          {% for edge in product.images %}
          <div class="carousel-item {% if forloop.first %}active{% endif %}">
              <img src="{{ edge.src }}" class="d-block w-100" />
            </div>
          {% endfor %}
        </div>
        {% if product.images|length > 1 %}
        <a class="carousel-control-prev text-primary" href="#carouselExampleControls" role="button" data-slide="prev">
          <i class="fa fa-2x fa-chevron-left"></i>
          <span class="sr-only">Previous</span>
        </a>
        <a class="carousel-control-next text-primary" href="#carouselExampleControls" role="button" data-slide="next">
          <i class="fa fa-2x fa-chevron-right"></i>
          <span class="sr-only">Next</span>
        </a>
        {% endif %}
      </div>

      <div class="social text-center my-3">
        <a href="https://twitter.com/intent/tweet?text={{ product.title | urlencode }}&url={% setting BASE_URL %}{{ page.url | urlencode }}&via={{ site.social.twitter }}&hashtags=11ty,shopify" target="_blank">
          <i class="fa fa-fw fa-2x fa-twitter text-black-50"></i>
        </a>
        <a href="https://www.facebook.com/dialog/share?app_id={{ site.social.fb_appid }}&display=popup&href=&href={% setting BASE_URL %}{{ page.url | urlencode }}" target="_blank">
          <i class="fa fa-fw fa-2x fa-facebook text-black-50"></i>
        </a>
        <a href="https://www.pinterest.com/pin/create/button/?description={{ product.description | urlencode }}&url={% setting BASE_URL %}{{ page.url | urlencode }}&media={{ product.images.0.src }}" target="_blank">
          <i class="fa fa-fw fa-2x fa-pinterest text-black-50"></i>
        </a>
      </div>
    </div>

    <div class="col-12 col-lg-5">
      {% comment %} {% if product.variants|length > 1 %} {% endcomment %}
        {% for variant in product.variants %}
          <p>
            <button class="btn btn-sm btn-outline-secondary" data-action="click->product#add" data-variant-id="{{variant.id}}">{{variant.price}}</button>
            <div>{{variant.title}}</div>
          </p>
        {% endfor %}

        {% comment %} <button class="btn btn-sm btn-primary"
          data-target="product.cartButton"
          data-action="product#add" disabled>Add to Cart</button> {% endcomment %}

      {% comment %} {% else %}
        {% with product.variants|first as edge %}
          
          {% if product.availableForSale %}
          <button class="btn btn-sm btn-primary"
            data-target="product.cartButton"
            data-action="product#add"
            data-id="{{edge.id}}"
            data-options='{{ edge.selectedOptions | valid_json }}'>
              Add to Cart
          </button>
          {% endif %}
          {% if not product.availableForSale %}
          <button class="btn btn-sm btn-secondary"
                  data-target="product.notifyMe"
                  data-action="product#notify" >Notify Me!</button>
          {% endif %}

        {% endwith %}
      {% endif %} {% endcomment %}

      <hr/>

      <div class="product-description">{{ product.body_html | safe }}</div>

      {% comment %} {% if product.tags %}
        <aside class="preorder">
        </aside>
      {% endif %} {% endcomment %}

      <hr/>

      <div class="product-tags">{{ product.tags }}</div>
    </div>

  </div>
</article>

{% endblock %}

{% extends "base.html" %}
{% load wagtailcore_tags wagtailimages_tags setting valid_json djmoney date django_bootstrap5 negate %}



{% block content%}

<article
  {% if user.is_member %}
      {% comment %} Entirely disable Shopify Checkout functionality to be safe {% endcomment %}
      data-controller="product"
      data-product-shopify-domain-value="{% setting 'SHOPIFY_DOMAIN' %}"
      data-product-shopify-storefront-access-token-value="{% setting 'SHOPIFY_STOREFRONT_ACCESS_TOKEN' %}"
      data-product-shopify-collection-id-value="{% setting 'SHOPIFY_COLLECTION_ID' %}"
      data-product-shopify-product-id-value="gid://shopify/Product/{{ page.shopify_product_id }}"
      data-product-user-email-value="{{ user.primary_email }}"
      data-product-stripe-shipping-value='{{ user.stripe_customer.shipping|valid_json }}'
  {% endif %}
>
  <div class="row">
    {% if page.image_url %}
    <div class="col-12 col-md-6">
      <div class='sticky sticky-top'>
        <img src="{{ page.image_url }}" class="d-block w-100" />
        <div class='position-absolute tw-bottom-2 tw-left-2 text-dark fs-7 tw-z-50'>
          {{ page.published_date|date:"F Y" }}
        </div>
        {% if page.type %}
        <div class='position-absolute tw-bottom-2 tw-right-2 fs-7 tw-z-50 text-capitalize
          {% if page.type == "classic" %}
            tw-bg-black tw-text-white tw-px-1
          {% elif page.type == "contemporary" %}
            tw-bg-yellow tw-text-black tw-px-1
          {% else %}
            text-dark
          {% endif %}
        '>
          {{ page.type }}
        </div>
        {% endif %}
      </div>

      {% comment %} <div class="social text-center my-3">
        <a href="https://twitter.com/intent/tweet?text={{ page.title | urlencode }}&url={% setting BASE_URL %}/{{ page.url | urlencode }}&via={{ site.social.twitter }}&hashtags=11ty,shopify" target="_blank">
          <i class="fa fa-fw fa-2x fa-twitter text-black-50">Share to Twitter</i>
        </a>
        <a href="https://www.facebook.com/dialog/share?app_id={{ site.social.fb_appid }}&display=popup&href=&href={% setting BASE_URL %}/{{ page.url | urlencode }}" target="_blank">
          <i class="fa fa-fw fa-2x fa-facebook text-black-50">Share to Facebook</i>
        </a>
        <a href="https://www.pinterest.com/pin/create/button/?description={{ page.description | urlencode }}&url={% setting BASE_URL %}/{{ page.url | urlencode }}&media={{ page.image_url }}" target="_blank">
          <i class="fa fa-fw fa-2x fa-pinterest text-black-50">Share to Pinterest</i>
        </a>
      </div> {% endcomment %}
    </div>
    {% endif %}

    <div class="col">
      <header class='mb-3 lh-2'>
        <h1 class='m-0 fs-2'>{{page.title}}</h1>    
        {% if page.subtitle %}
          <h2 class='m-0 fs-2 text-secondary'>{{page.subtitle}}</h2>
        {% endif %}
        {% if page.authors %}
          <div class='h5 fs-2'>By {{ page.authors|join:", "}}</div>   
        {% endif %}
        {% for forward in page.forward_by %}
          <div>{{ forward }}</div>
        {% endfor %}
        {% if page.original_publisher %}
          <div class='text-secondary fs-6'>Originally published by {{  page.original_publisher }}</div>
        {% endif %}
      </header>
  
      <hr />
      {% if not user.is_member %}
      <div class='rounded-3 border-1 border-primary p-3 my-3'>
          <h5>Become a member to buy this book</h5>
          <p>Our books are exclusively re-published for Left Book Club members. Sign up today and stock up on what thousands of fellow readers have been discussing together.</p>
          {% bootstrap_button href="/join" content="Become a member" button_class='btn-primary my-2' %}
          or
          <a href="{% url 'account_login' %}?next={{ request.get_full_path }}" class="btn btn-outline-primary me-2">Login</a>
      </div>   
      {% endif %}   
      <turbo-frame id='cartoptions' src="{% url 'cartoptions' product_id=page.shopify_product_id %}?disabled={{user.is_member|negate}}">
        {% comment %} Start with cached information, then load in newer info {% endcomment %}
        {% include "app/includes/cart_options.html" with product=product loading=True disabled=user.is_member|negate %}
      </turbo-frame> 
      <hr />

      <section>
          <div class="product-description">{{ page.description | richtext }}</div>
      </section>
    </div>

  </div>
</article>

{% if page.layout %}
  {% include "app/includes/layout.html" with streamfield=page.layout %}
{% endif %}

{% endblock %}

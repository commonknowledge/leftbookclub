{% extends "base.html" %}
{% load wagtailcore_tags static wagtailroutablepage_tags django_bootstrap5 setting url brand %}

{% block content %}
  {% load wagtailcore_tags django_bootstrap5 djmoney %}
  {% with request.GET.gift_mode as gift_mode %}
  {% with request.GET.annual as annual %}
  {% with page.products.all as products %}
    <div class='text-muted'>Membership plan</div>
    <h1>{{ page.title }}</h1>
    <div>
      <span class='h5'>{{ request_price }}</span>
      {% if not annual %}
        {% qs_link annual="true" as url %}
        {% bootstrap_button button_class='btn-outline-secondary' size='sm' href=url content="Switch to annual pricing" %}
      {% else %}
        {% qs_link annual=None as url %}
        {% bootstrap_button button_class='btn-outline-secondary' size='sm' href=url content="Switch to monthly pricing" %}
      {% endif %}
    </div>
    <h5>A book {{ page.delivery_frequency }}</h5>

    <section class='my-4'>
      {{ page.description|richtext }}
    </section>

    <section>
    {% if products|length == 1 %}
      {% url "plan_shipping" price_id=request_price.id product_id=products.0.id as url %}
      {% qs_link gift_mode=None as not_gift_qs %}
      {% bootstrap_button href=url|add:not_gift_qs content="Select" %}
      {% qs_link gift_mode=True as gift_qs %}
      {% bootstrap_button href=url|add:gift_qs content="Get this as a gift" %}
    {% else %}
      <h3>{{page.pick_product_title}}</h3>
      {% if page.pick_product_text %}{{page.pick_product_text|richtext}}{% endif %}
      <div class='row gx-3'>
      {% for product in products %}
        <article class='col-12 col-md-6 col-lg-4'>
          <div class='{% brand_background_by_index forloop.counter0 %} overflow-hidden h-100 d-flex flex-column'>
            <div class='p-4'>
              <h3 class='mb-2'>{{ product.name }}</h3>
              <div class='mt-2'>{{product.description }}</div>
            </div>
            <div class='mt-auto p-4'>
              {% url "plan_shipping" price_id=request_price.id product_id=product.id as url %}
              {% qs_link gift_mode=None as not_gift_qs %}
              {% bootstrap_button button_class='btn-outline-dark' href=url|add:not_gift_qs content="Select" %}
              {% qs_link gift_mode=True as gift_qs %}
              {% bootstrap_button button_class='btn-outline-dark' href=url|add:gift_qs content="Get this as a gift" %}
            </div>
          </div>
        </article>
      {% endfor %}
      </div>
    {% endif %}
    </section>
  {% endwith %}
  {% endwith %}
  {% endwith %}
{% endblock %}

{% extends "base.html" %}
{% load wagtailcore_tags static wagtailroutablepage_tags django_bootstrap5 setting url brand %}

{% block content %}
  {% load wagtailcore_tags django_bootstrap5 djmoney %}
  {% with request.GET.gift_mode as gift_mode %}
  {% with request.GET.annual as annual %}
  {% with page.products.all as products %}
    <div class='text-muted'>Membership plan</div>
    <h1>{{ page.title }}</h1>
    <h5>{{ request_price }}</h5>
    <h5>{{ page.deliveries_per_year }} deliveries per year</h5>
    <h5>{{ page.description|richtext }}</h5>

    <hr />
    {% if not gift_mode %}
      {% qs_link gift_mode="true" as url %}
      {% bootstrap_button button_class='btn-outline-secondary' size='sm' href=url content="Gift a membership" %}
    {% else %}
      {% qs_link gift_mode=None as url %}
      {% bootstrap_button button_class='btn-outline-secondary' size='sm' href=url content="Buy yourself a membership instead" %}
    {% endif %}
    {% if not annual %}
      {% qs_link annual="true" as url %}
      {% bootstrap_button button_class='btn-outline-secondary' size='sm' href=url content="Switch to annual pricing" %}
    {% else %}
      {% qs_link annual=None as url %}
      {% bootstrap_button button_class='btn-outline-secondary' size='sm' href=url content="Switch to monthly pricing" %}
    {% endif %}
    <hr />

    {% qs_link as qs %}
    <section>
    {% if products|length == 1 %}
      {% url "plan_shipping" price_id=request_price.id product_id=products.0.id as url %}
      {% bootstrap_button href=url|add:qs content="Select" %}
    {% else %}
      <h3>{{page.pick_product_title}}</h3>
      {% if page.pick_product_text %}{{page.pick_product_text|richtext}}{% endif %}
      <div class='row'>
      {% for product in products %}
        <article class='col-12 col-md-6 col-lg-4'>
          <div class='{% brand_background_by_index forloop.counter0 %} overflow-hidden'>
            <div class='p-4'>
              <h3>{{ product.name }}</h3>
              <div>{{product.description }}</div>
              {% qs_link as qs %}
              <div class='mt-3'>
                {% url "plan_shipping" price_id=request_price.id product_id=product.id as url %}
                {% bootstrap_button button_class='btn-outline-dark' href=url|add:qs content="Select" %}
              </div>
            </div>
          </div>
        </article>
      {% endfor %}
      </div>
    {% endif %}
    </section>
  {% endwith %}
  {% endwith %}
  {% endwith %}
{% endblock %}
